"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _react = _interopRequireDefault(require("react"));

var _reactJss = require("react-jss");

var _jsxFileName = "/Users/misiek/dev/gatsby-publish/packages/gatsby-plugin-jss/src/gatsby-ssr.js";

/**
 * Keep track of SheetRegistry for each page
 */
var sheetsRegistryManager = new Map(); // eslint-disable-next-line react/prop-types,react/display-name

exports.wrapRootElement = function (_ref, _ref2) {
  var element = _ref.element,
      pathname = _ref.pathname;
  var _ref2$theme = _ref2.theme,
      theme = _ref2$theme === void 0 ? {} : _ref2$theme;
  var sheets = new _reactJss.SheetsRegistry();
  sheetsRegistryManager.set(pathname, sheets);
  return _react.default.createElement(_reactJss.JssProvider, {
    registry: sheets,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 15
    },
    __self: this
  }, _react.default.createElement(_reactJss.ThemeProvider, {
    theme: theme,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 16
    },
    __self: this
  }, element));
};

exports.onRenderBody = function (_ref3) {
  var setHeadComponents = _ref3.setHeadComponents,
      pathname = _ref3.pathname;
  var sheets = sheetsRegistryManager.get(pathname);

  if (sheets) {
    setHeadComponents([_react.default.createElement("style", {
      type: "text/css",
      id: "server-side-jss",
      key: "server-side-jss",
      dangerouslySetInnerHTML: {
        __html: sheets.toString()
      },
      __source: {
        fileName: _jsxFileName,
        lineNumber: 25
      },
      __self: this
    })]);
    sheetsRegistryManager.delete(pathname);
  }
};